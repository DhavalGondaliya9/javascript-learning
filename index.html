<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Retail Shop</title>
        <script src="https://cdn.tailwindcss.com"></script>
    </head>
    <body class="bg-gray-200">
        <div class="container mx-auto px-5 bg-white">
            <div class="flex lg:flex-row flex-col-reverse shadow-lg">
                <div class="w-full lg:w-3/5 min-h-screen shadow-lg">
                    <div class="flex flex-row justify-between items-center px-5 mt-5">
                        <div class="text-gray-800">
                            <div class="font-bold text-xl">Dhaval Retail Shop</div>
                            <span class="text-xs">
                                "Aashirvad", 7-Nandhinagar, Nanavati Chowk, Rajkot-360007
                            </span>
                        </div>
                        <input type="text" placeholder="Search Products" class="w-full h-12 px-4 text-sm text-gray-700 bg-white border border-gray-300 rounded-lg lg:w-20 xl:transition-all xl:duration-300 xl:w-36 xl:focus:w-44 lg:h-10 dark:bg-gray-900 dark:text-gray-300 dark:border-gray-600 focus:border-teal-500 dark:focus:border-teal-500 focus:outline-none focus:ring focus:ring-primary dark:placeholder-gray-400 focus:ring-opacity-40" id="searchbar">
                    </div>
                    <div class="grid grid-cols-3 gap-4 px-5 mt-5 overflow-y-auto h-3/4">
                        <div id="not-available" style="display: none;">
                            <h5 style="width: 400px;">
                                Sorry, the products has not been added yet...
                            </h5>
                        </div>
                        <template>
                            <h1>Hello world</h1>
                        </template>
                        <div id="items" style="display: contents">
                            <div class="transform hover:scale-105 transition duration-300 px-3 py-3 flex flex-col border border-gray-200 rounded-md h-32 justify-between">
                                <!-- <div> -->
                                    <label hidden id="">
                                    </label>
                                    <label hidden id="">
                                    </label>
                                    <div class="font-bold text-gray-800" id="">
                                        dairy Milk
                                    </div>
                                    <span class="font-light text-sm text-gray-400" id="">
                                        50
                                    </span>
                                <!-- </div> -->
                                <div class="flex flex-row justify-between items-center">
                                    <div class="flex space-x-0 self-end font-bold text-lg text-yellow-500">
                                        <span>$</span>
                                        <span>
                                            price
                                        </span>
                                    </div>
                                    <div class="flex space-x-0 self-end font-bold text-lg text-red-500">
                                        <span>
                                            tax
                                        </span>
                                        <span>%</span>
                                    </div>
                                    <img src="https://picsum.photos/50/50" class="h-14 w-14 object-cover rounded-md" alt="Product Image">
                                </div>

                            </div>
                        </div>

                    </div>
                </div>
                <div class="w-full lg:w-2/5">
                    <div class="flex flex-row items-center justify-between px-5 mt-5">
                        <div class="font-bold text-xl">Current Order</div>
                        <div class="font-semibold">
                            <span class="px-4 py-2 rounded-md bg-red-100 text-red-500" onclick="containerClean()">
                                Clear All
                            </span>
                        </div>
                    </div>
                    <div class="px-5 py-4 mt-5 overflow-y-auto h-64 cart-content" id="container">

                    </div>
                    <div class="px-5 mt-5">
                        <div class="py-4 rounded-md shadow-lg">
                            <div class=" px-4 flex justify-between">
                                <span class="font-semibold text-sm">Subtotal</span>
                                <span class="font-bold sub-total" id="subtotal">$0</span>
                            </div>
                            <div class=" px-4 flex justify-between">
                                <span class="font-semibold text-sm">Discount</span>
                                <img src="/images/discount.png" style="width:20px;margin-right: 0px;position:absolute;right: 430px;" onclick="displayApplicableDiscountsModal('discount-modal-id')" id="discount-img">
                                <div class="hidden opacity-25 fixed inset-0 z-40 bg-black" id="discount-modal-id-backdrop"></div>
                                <span class="font-bold" id="discount-price">- $0.00</span>
                            </div>
                            <div class=" px-4 flex justify-between">
                                <span class="font-semibold text-sm">Sales Tax</span>
                                <span class="font-bold" id='sales-tax'>+ $0.00</span>
                            </div>
                            <div class="border-t-2 mt-3 py-2 px-4 flex items-center justify-between">
                                <span class="font-semibold text-2xl">Total</span>
                                <span class="font-bold text-2xl total-price" id="total">$0.00</span>
                            </div>
                        </div>
                    </div>
                    <div class="px-5 mt-5">
                        <form method="post">
                            <div id='hidden-form'></div>
                            <button name="submit" class="px-4 py-4 rounded-md shadow-lg text-center bg-yellow-500 text-white font-semibold" style="width: 500px;">Complete Sale</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <script>
            const randomNameGenerator = (num) => {
                let res = '';
                for(let i = 0; i < num; i++){
                    const random = Math.floor(Math.random() * 27);
                    res += String.fromCharCode(97 + random);
                };
                return res;
            };
            let items = [];
            let count = 0;
            for (let i=0; i < 10; i++) {
                items.push({
                    id: count,
                    name: randomNameGenerator(8),
                    image: 'https://picsum.photos/50/50',
                    quantity:Math.floor(Math.random() * 10) + 1,
                    price:Math.floor(Math.random() * 1000) + 200,
                    discount:Math.floor(Math.random() * 30) + 1,
                    tax:18
                });
            }
            var item = items[Math.floor(Math.random()*items.length)];

            document.getElementById('items').innerHTML = '';
            for (let i=0; i < items.length; i++) {
                let div = document.createElement('div');
                div.setAttribute('id', 'item-' + items[i].id);
                div.setAttribute('class', 'transform hover:scale-105 transition duration-300 px-3 py-3 flex flex-col border border-gray-200 rounded-md h-32 justify-between');
                div.setAttribute('onclick', 'addItem('+i+')');
                document.getElementById('items').appendChild(div);
                let parentDiv = document.createElement('div');
                let subParentDiv = document.createElement('div');

                subParentDiv.setAttribute('class', 'font-bold text-gray-800');
                subParentDiv.innerHTML= items[i].name;
                parentDiv.appendChild(subParentDiv);

                subParentSpan = document.createElement('span');
                subParentSpan.setAttribute('class', 'font-light text-sm text-gray-400');
                subParentSpan.innerHTML= 'Quantity: '+items[i].quantity;

                parentDiv.appendChild(subParentSpan);
                div.appendChild(parentDiv);
                //
                let parentDiv2 = document.createElement('div');
                let parentImg = document.createElement('img');
                parentImg.setAttribute('src', items[i].image);
                parentImg.setAttribute('class', 'h-14 w-14 object-cover rounded-md');

                parentDiv2.setAttribute('class', 'flex flex-row justify-between items-center');

                subParentDiv2 = document.createElement('div');
                subParentDiv2.setAttribute('class', 'flex space-x-0 self-end font-bold text-lg text-yellow-500');
                subParentSpan2 = document.createElement('span');
                subParentSpan2.innerHTML= '$'+items[i].price;
                subParentDiv2.appendChild(subParentSpan2);
                parentDiv2.appendChild(subParentDiv2);
                //
                subParentDiv2 = document.createElement('div');
                subParentDiv2.setAttribute('class', 'flex space-x-0 self-end font-bold text-lg text-red-500');
                subParentSpan2 = document.createElement('span');
                subParentSpan2.innerHTML= items[i].tax+'%';
                subParentDiv2.appendChild(subParentSpan2);
                parentDiv2.appendChild(subParentDiv2);

                parentDiv2.appendChild(parentImg);
                div.appendChild(parentDiv2);
                document.getElementById('items').appendChild(div);
            }
            //add Item
            const addItem = ($i) => {
                //decrease quantity
                items[$i].quantity = items[$i].quantity - 1;

                let newProductElement = createCartProduct(items[$i]);
                let element=document.createElement('div');
                    element.innerHTML=newProductElement;
                let cartBasket = document.querySelector('.cart-content');
                cartBasket.append(element);
                loadContent();
            }

            //
            function createCartProduct(item) {

  return `  <div class="flex flex-row justify-between items-center mb-4 cart-box">
                <div class="flex flex-row items-center w-2/5">
                    <input type="hidden" class="discount" value="${item.discount}">
                    <img src="${item.image}" class="w-10 h-10 object-cover rounded-md">
                    <span class="ml-4 font-semibold text-sm">${item.name}</span>
                </div>
                <div class="w-32 flex justify-between">
                    <button class="px-3 py-1 rounded-md bg-gray-300 decrease">-</button>
                    <input class="mx-2 border text-center w-8 input-quantity cart-quantity" value="1" type="number">
                    <button class="px-3 py-1 rounded-md bg-gray-300 increase">+</button>
                </div>
                <div class="flex pl-3 font-semibold text-lg w-16 text-center" >
                    <div class="currency-sign">$</div>
                    <div class="price cart-price">${item.price}</div>
                </div>
                <span class="px-3 py-1 rounded-md bg-red-300 text-white cart-remove">x</span>
            </div>
  `;
}
function loadContent(){
    let qtyElements = document.querySelectorAll('.cart-quantity');
    qtyElements.forEach((input)=> {
        input.addEventListener('change',changeQty);
    });

    let btnRemove=document.querySelectorAll('.cart-remove');
    btnRemove.forEach((btn)=> {
        btn.addEventListener('click',removeItem);
    });

    // let increase = document.querySelectorAll('.increase');
    // increase.forEach((btn)=> {
    //     btn.addEventListener('click',increseQty);
    // });

    updateTotal();
}

  function changeQty(){
    if(isNaN(this.value) || this.value<1){
        this.value=1;
    }
    loadContent();
  }

//   function increseQty() {
//     console.log(this.closest(".cart-quantity").value);
//     // console.log(this.parentElement.closest(".cart-quantity").value);
//     loadContent();
//   }

function removeItem(){
    if(confirm('Are Your Sure to Remove')){
        this.parentElement.remove();
        loadContent();
    }
}
function containerClean() {
    document.querySelector('.cart-content').innerHTML = '';
    updateTotal();
}
function updateTotal() {
    const cartItems    = document.querySelectorAll('.cart-box');
    const totalValue   = document.getElementById('total');
    const subTotal     = document.getElementById('subtotal');
    const salesTax     = document.getElementById('sales-tax');
    const totalDiscount= document.getElementById('discount-price');
    let total = 0;
    let discount = 0;
    cartItems.forEach(product=> {
        let priceElement    = product.querySelector('.cart-price');
        let discountElement = product.querySelector('.discount');
        let price           = parseFloat(priceElement.innerHTML.replace("$",""));
        let qty             = product.querySelector('.cart-quantity').value;
        let discountPersontage = product.querySelector('.discount').value;
        // product.querySelector('.cart-price').innerText=(price*qty);
        discount+= (price * discountPersontage) / 100;
        total+= (price*qty);
    });
  subTotal.innerHTML    = '$'+total.toFixed(2);

  totalDiscount.innerHTML = '- $'+discount.toFixed(2);
  const tax             = 18;
  const totaltax        = (total * tax) / 100;
  salesTax.innerHTML    = '+ $'+totaltax.toFixed(2);
  const alltotal        = (total + totaltax) - discount;
  totalValue.innerHTML  = '$'+alltotal.toFixed(2);
}
        </script>
    </body>
</html>